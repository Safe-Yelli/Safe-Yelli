---
title: |
  Streetlights and sidewalks under the Hebbala Flyover - Unsafe for women

format:
  pdf:
    documentclass: report

draft: no
type: collated-report

geometry: margin=1.5cm  

header-includes: 
      - \usepackage{graphicx}
      - \usepackage{fancyhdr}
      - \pagestyle{fancy}
      - \usepackage{titling}
      - \fancyhead[R]{\includegraphics[width=0.6cm]{../../static/images/logo.png}}
      - \renewcommand{\headrulewidth}{0.4pt}
      - \renewcommand{\footrulewidth}{0.4pt}
      - \pretitle{\begin{flushleft}
        \includegraphics[width=2cm]{../../static/images/logo.png}
        \newline
        \LARGE}
      - \posttitle{\end{flushleft}}
      - \predate{\begin{flushleft}}
      - \postdate{\end{flushleft}}

---

To,

Whomsoever it concerns,

BBMP

Subject: Working condition of streetlights and sidewalks near and under the Hebbala Flyover

We mapped the conditions of the streetlights and sidewalks near the Hebbala Flyover. *These are particularly unsafe roads for women under dark conditions*. Some areas *don't have sidewalks especially on the opposite side of Esteem mall*. Please take steps to rectify the situation. 


```{r message=FALSE, warning=FALSE, include=FALSE}

library(tidyverse) 
library(htmltools)
library(ggplot2)
library(dplyr)
library(sf)

extrafont::loadfonts(device="win")
windowsFonts(Corbel =windowsFont("Corbel"))
```


```{r Read data, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
lamps <- read_sf("../../resources/assets/Mapping-Hebbala/streetlamps.geojson") %>% as_tibble()
roads <- read_sf("../../resources/assets/Mapping-Hebbala/roads.geojson")%>% as_tibble()
sidewalks <- read_sf("../../resources/assets/Mapping-Hebbala/sidewalks.geojson")%>% as_tibble()
crossings <- read_sf("../../resources/assets/Mapping-Hebbala/crossings.geojson")%>% as_tibble()


lamps$status <- lamps$status %>% 
  str_replace_all("not_working", replacement = "not working") %>% 
  str_replace_all("needs_maintenance", replacement = "needs maintenance")


# map tiles from mapbox
mapUrl="https://api.mapbox.com/styles/v1/rungdung/cku6gh76r1dvh17o3zkfllvjz/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoicnVuZ2R1bmciLCJhIjoiY2tqeWh6cXF4MDgzMjJvbWVmbGQzYjAwMyJ9.U-aJyoqyKvTXlhVk43jV1A"

darkMapUrl= "https://api.mapbox.com/styles/v1/rungdung/cl3jusid0001g15odcz3f1dcb/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoicnVuZ2R1bmciLCJhIjoiY2tqeWh6cXF4MDgzMjJvbWVmbGQzYjAwMyJ9.U-aJyoqyKvTXlhVk43jV1A"
```



```{r data mutate, echo=FALSE, eval=TRUE, fig.width=7.5, message=FALSE, warning=FALSE}
#| layout: [[100],[100]]
#| fig-subcap: 
#|    - Number of streetlights that were not working
#|    - Sidewalks that had gaps and/or shaky
p1 <- lamps %>%ggplot(aes(y= after_stat(count), x=status)) + 
  geom_bar() +
  labs(x = "Status", y="Count")+
  scale_fill_manual( values = c( "not working"="red") ) 



p2 <- ggplot(sidewalks, aes(x=`Walkability`)) +
  geom_bar(stat="count") +
  labs(x = "Hour of Incident (24Hr format)", y="Number of Incidents") +
  theme(axis.text.x = element_text(angle = 50, vjust = 01, hjust=1),
        rect = element_rect(fill = "transparent",
                            colour = NA_character_), # necessary to avoid drawing panel outline
        text = element_text(size = 14, 
                            colour = "gray"), 
        plot.title = element_text(size = 20,
                                  color = "white"),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        panel.background = element_rect(fill="transparent",
                                        colour = NA_character_), # necessary to avoid drawing panel outline
        axis.line = element_line(colour = "gray")) 

p1

p2
  
```