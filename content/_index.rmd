---
title: "Mapping harassment in Yelahanka"

description: "A citizen centric tool to report harassment and assault inside Yelahanka. Visualise our community's citizen reported crime data on a map."
draft: false

####################### Banner #########################
banner:
  title : "Mapping harassment in Yelahanka"
  content : "A citizen centric tool to report harassment and assault inside Yelahanka. Visualise our community's citizen reported crime data on a map. \n \n ಯಲಹಂಕದ  ನಗರವಾಸಿಗಳಿಗೆ  ಇಲ್ಲಿ ನಡೆಯುವ ದೌರ್ಜನ್ಯ ಮತ್ತು ಕಿರುಕುಳವನ್ನು ರಿಪೋರ್ಟ್ ಮಾಡುವ ಉಪಕರಣ. ಇಲ್ಲಿ ಸಂಗ್ರಹವಾದ ಅಪರಾಧ ವರದಿಗಳನ್ನು ನಕ್ಷೆಯ ಮೇಲೆ ಕಾಣಬಹುದು "
  button:
    enable : true
    label : "Report / ಘಟನೆಯನ್ನು ರಿಪೋರ್ಟ್ ಮಾಡಿ"
    link : "report"
 
##################### Feature #######################
---
```{r setup, include=FALSE} 
knitr::opts_chunk$set(echo = TRUE) 

library(tidyverse) 
library(sf)
library(leaflet)
library(leaflet.providers) 
library(leaflet.extras)

library(htmltools)
library(crosstalk)

library(lubridate)
library(DT)
library(widgetframe)
```

```{r reading data, include=FALSE}
oldHarassData <- read_csv('../resources/assets/formResponses2.csv') 
#oldHarassData <- oldHarassData %>% separate(., col = `What are the exact coordinates of the incident?`, into = c("Location.lat", "Location.lon"), sep = "\\,")

newHarassData <-read_csv('../resources/assets/ushahidiResponses3.csv')

mapUrl="https://api.mapbox.com/styles/v1/rungdung/cku6gh76r1dvh17o3zkfllvjz/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoicnVuZ2R1bmciLCJhIjoiY2tqeWh6cXF4MDgzMjJvbWVmbGQzYjAwMyJ9.U-aJyoqyKvTXlhVk43jV1A"
```



```{r merging dataframes and creating sf frames, include=FALSE}
allData <- rbind(oldHarassData,newHarassData)
allData <- rename(allData, lat=Location.lat, lng = Location.lon)

# Attach a coordinate reference 
allCoords <- allData %>%
  st_as_sf(coords = c('lng', 'lat'),crs = 4326) 
```

```{r operations on data, echo=FALSE, message=FALSE, warning=FALSE}
allData <- allData %>% 
  mutate(date = as.Date(`When and at what time this happen?`, '%d/%m/%Y'),
         year = as.character(year(date)),
         month = as.character(month(date)),
         hour = as.integer(format(as.POSIXct(`When and at what time this happen?`, tz="Mumbai"), 
                           format="%H"))
         )
```

```{r Formatting popup text, message=FALSE, warning=FALSE, include=FALSE}
allData$popupText <- 
  paste0('<strong>', allData$`Describe the incident in one line`, '</strong>',
         '<br/> <br/>',
         format(
           as.POSIXct(allData$`When and at what time this happen?`, format="%d-%m-%Y %H:%M", tz="Mumbai"),
           format='%B %d %Y, Time: %H %M'),
         '<br/> <br/>', 
         allData$`Describe the incident in detail`, ' ') %>% 
  lapply(htmltools::HTML)
```

```{r Creating shared data frame for crosstalk, echo=FALSE, message=FALSE, warning=FALSE}
sharedD <- SharedData$new(allData)
```

```{r Mappinnng!, echo=FALSE, message=FALSE, warning=FALSE}
#addProviderTiles(providers$CartoDB.Positron) not working
map <- leaflet(sharedD) %>%
  addTiles(urlTemplate = mapUrl) %>%
  fitBounds(77.564292, 13.096725, 77.591393, 13.109996) %>%
  setMaxBounds(77.554808, 13.087922, 77.608495, 13.114213) %>%
  addScaleBar() %>%
  addLayersControl(
    #baseGroups = c("Incidents"),
    overlayGroups = c("Heat Map", "Incidents"),
    options = layersControlOptions(collapsed = FALSE)
  ) %>%
  
   addMarkers(
    popup = paste(allData$popupText),
    popupOptions = popupOptions(maxWidth = 400),
    #clusterOptions = clusterOptions(),
    group = "Incidents",
  ) %>%

  
  addHeatmap(
    radius = 20,
    blur = 20,
    intensity = 0.7,
    cellSize = 0.1,
    minOpacity = 0.4,
    max = 0.9,
    group = "Heat Map"
  )
# Layers
# addPolygons(data = emptyPlot,
#             color = 'grey',
#             stroke=FALSE,
#             label = emptyPlot$Name,
#             group="Empty Plots") %>%
# addPolygons(data = infrasPlot,
#             color = 'red',
#             stroke=FALSE,
#             label = infrasPlot$Name,
#             group="Dilipated infrastructure") %>%
# addPolygons(data = shopPlot,
#             color = 'green',
#             stroke=FALSE,
#             label = shopPlot$Name,
#             group="Shops")
```

```{r formatting output,echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

#dateFilter <- filter_slider("date", "", sharedD, column= ~date, step=3, width=800)
typeFilter <- filter_checkbox("Incident type", "Type", sharedD, group= ~`What kind of incident was this?`, inline = FALSE )
yearFilter <- filter_checkbox("Year", "Year", sharedD, group= ~year, inline = FALSE )
timeOfDayFilter <- filter_slider("Hour","", sharedD,  column=~"Hour", step=1, width=200, min=0, max=24)

displayData <- allData %>%
  select(date,
         `Describe the incident in one line`,
         `Describe the incident in detail`) %>%
  datatable(
  extensions = "Scroller",
  style = "bootstrap",
  class = "compact",
  width = "100%",
  options = list(
    deferRender = TRUE,
    scrollY = 300,
    scroller = TRUE
  )
)

# map  


tags$div(class = "map-section",
           #dateFilter,
           tags$div(class = "crosstalk-map",
                    map),
          
           tags$div(class = "crosstalk-filters", tags$h4('Map filters:'), yearFilter, typeFilter)
                    
         )

#widgetframe::frameWidget(displayData)
```


`r blogdown::shortcode_open("faq", "Why should you report?")`
> "Because it's on you to always do the right thing"

If you are being harassed, there are certain steps you can take to stop them. If you don't report it, they're just going to keep doing it. You now have the power to do something about it. Every report helps us paint a more comprehensive picture, essentially mapping these crimes in order to influence policing and public policy. 
`r blogdown::shortcode_close("faq")`

`r blogdown::shortcode_open("faq", "How can you help?")`
> **"If you see something, do something"**

If you see sexual assault, harassment or catcalling happen to someone else or if something happens to you, go to the police and file a report. Additionally, take 5 minutes and fill out this form so that you can contribute to a larger cause with your story.
`r blogdown::shortcode_close("faq")`

`r blogdown::shortcode_open("faq", "Why does it matter?")`
> **"Because If you don't do anything about it, you become complicit"**

As socially responsible human beings, it is our duty to do everything we can to make sure that the world is a safer place today than it was yesterday. Seems far fetched? Well, Let's start with making our immediate surroundings safe. Let's strive towards a society where a woman can walk down the street without fear of harassment! 
`r blogdown::shortcode_close("faq")`

# Defining harassment and other terms
 
(The law provides a clear enough definition of assault)

1.  Assault: Whoever assaults or uses criminal force to any woman(or man\*), intending to outrage or knowing it to be likely that he will thereby outrage her modesty (Sec 354 IPC).

2.  Harassment:  Sexual harassment is unwanted behaviour of a sexual nature which: violates your dignity. makes you feel intimidated, degraded or humiliated. creates a hostile or offensive environment.

Section 506 IPC - criminal intimidation. (Reverse the gender roles and it still constitutes harassment. Women can also be reported under 506 - Criminal intimidation)\

Even though there is no 'catcalling' or 'eve teasing' law in India. People often use Sec 294 IPC in cases relating to such offences

3.  Obscene acts and songs.---Whoever, to the annoyance of others---
 
    (a) does any obscene act in any public place, or

    (b) sings, recites or utters any obscene song, ballad or words, in or near any public place 
    

