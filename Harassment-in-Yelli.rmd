---
title: "Mapping harassment in Yelahanka"
date: "28/09/2021"
output:
  html_document:
    theme: cosmo
    toc: yes
    toc_float: yes
    toc_depth: 2
    number_sections: no
    code_folding: hide
    code_download: yes
---
```{css, echo = F}
.title{
 font-size: 30px;
}
```
Abstract: To find spatial correlations between catcalling hot-spots and public-utility and attempt to affect public policy by running a pro-policing campaign with this tool

**This is currently only a working proof of concept. Not meant for public release yet.**



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(sf)
library(leaflet)
library(leaflet.providers)
library(leaflet.extras)
library(rgdal)
library(crosstalk)
```

```{r reading data, include=FALSE}
harassData <- read_csv('formResponses.csv')
harassData <- harassData %>% separate(., col = `Incident Location in Coordinates`, into = c("lat", "lng"), sep = "\\,")
# Attach a coordinate reference 
harassCoords <- harassData %>%
  st_as_sf(coords = c('lng', 'lat'),crs = 4326) 
harassCoords
```
# Use the map here {.tabset}
```{r reading files and other stuff, include=FALSE}
mapUrl="https://api.mapbox.com/styles/v1/rungdung/cku6gh76r1dvh17o3zkfllvjz/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoicnVuZ2R1bmciLCJhIjoiY2tqeWh6cXF4MDgzMjJvbWVmbGQzYjAwMyJ9.U-aJyoqyKvTXlhVk43jV1A"

# Read KML file's layers into separate objects
st_layers("hotspots.kml")
shopPlot = readOGR("hotspots.kml", layer="Shops")
emptyPlot = readOGR("hotspots.kml", layer="Empty plots")
infrasPlot = readOGR("hotspots.kml", layer="Dilipated public infrastructure")

# Convert year to field
#harassCoords <- harassCoords %>% mutate(`Year of Occurence`=as.Date(`Year of Occurence`))
shared_data <- SharedData$new(harassCoords)
filter_slider("date", "Date", shared_data, ~`Year of Occurence`) # not working yet 
# https://stackoverflow.com/questions/62849300/r-leaflet-add-a-range-slider-to-filter-markers-without-shiny

```

```{r Mappinnng!, echo=F, out.width='100%'}
#addProviderTiles(providers$CartoDB.Positron) not working
map<-leaflet(shared_data) %>% 
  addTiles(urlTemplate = mapUrl) %>% 
  fitBounds(77.554808,13.087922,77.608495,13.114213) %>% 
  setMaxBounds(77.554808,13.087922,77.608495,13.114213) %>% 
  addCircleMarkers(label = harassCoords$Misc,
                   opacity=0.09,
                   #fillColor = ~pal(`Year of Occurence`),
                   clusterOptions = markerClusterOptions(),
                   group = "Incident markers"
                   ) %>%
  
  # Layers
  addPolygons(data = emptyPlot,
              color = 'grey',
              stroke=FALSE,
              label = emptyPlot$Name,
              group="Empty Plots") %>% 
  addPolygons(data = infrasPlot,
              color = 'red',
              stroke=FALSE,
              label = infrasPlot$Name,
              group="Dilipated infrastructure") %>% 
  addPolygons(data = shopPlot,
              color = 'green',
              stroke=FALSE,
              label = shopPlot$Name,
              group="Shops") %>%
  
  
  addHeatmap(radius =18, 
             blur =15, 
             intensity = 0.7, 
             cellSize = 0.1, 
             minOpacity = 0.1,
             group = "Heat Map") %>% 
  
  # UI controls
  # addLegend(pal=pal,
  #          title="what is this",
  #          values= ~`Year of Occurence`) %>% 
  addScaleBar() %>% 
  addLayersControl(
    baseGroups = c("Heat Map","Incident markers"),
    overlayGroups = c("Empty Plots", "Dilipated infrastructure", "Shops"),
    options = layersControlOptions(collapsed = FALSE))

map
```

## Usage  {.tabset}

Use the selection tool on the right to shift between viewing a heat map and precise incidents.

## Infrastructure mapping 

You can use the checkboxes to enable and disable seeing the status of infrastructure around Yelahanka. Ill lit streets and parks are some of the infrastructure that would be mapped (InProgress)

# Concerns to focus on

# Affecting policy

# Telling your story

# Creators, contributors
Adhavan Mohana Sivaraj
Shashank C
Shresth Meharia
